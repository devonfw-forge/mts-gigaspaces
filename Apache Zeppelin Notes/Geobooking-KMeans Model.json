{"paragraphs":[{"title":"Get input values","text":"%spark\n\nval startDate = z.input(\"startDate\", 1546297200)\nval endDate = z.input(\"endDate\", 1609282800)\nval dishId = z.input(\"dishId\", 0)\n\n\n","user":"anonymous","dateUpdated":"2020-12-30T11:28:02+0100","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{"startDate":1577833200,"endDate":1609540625,"dishId":"0"},"forms":{"startDate":{"type":"TextBox","name":"startDate","displayName":"startDate","defaultValue":"1546297200","hidden":false,"$$hashKey":"object:674"},"endDate":{"type":"TextBox","name":"endDate","displayName":"endDate","defaultValue":"1609282800","hidden":false,"$$hashKey":"object:675"},"dishId":{"type":"TextBox","name":"dishId","displayName":"dishId","defaultValue":"0","hidden":false,"$$hashKey":"object:676"}}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nstartDate: Object = 1.5778332E9\nwarning: there was one deprecation warning; re-run with -deprecation for details\nendDate: Object = 1.609540625E9\nwarning: there was one deprecation warning; re-run with -deprecation for details\ndishId: Object = 0.0\n"}]},"apps":[],"jobName":"paragraph_1607354770475_-1697509130","id":"20201207-162610_349493717","dateCreated":"2020-12-07T16:26:10+0100","dateStarted":"2021-01-01T23:37:07+0100","dateFinished":"2021-01-01T23:37:09+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:528"},{"title":"Imports section","text":"%spark\nimport com.devonfw.application.mtsj.clustermanagement.dataaccess.api.GeobookingEntity\nimport org.insightedge.spark.implicits.all._\nimport org.insightedge.spark.context.InsightEdgeConfig\nimport org.apache.spark.ml.feature.VectorAssembler\nimport org.apache.spark.ml.clustering.KMeans\nimport spark.implicits._\nimport org.apache.spark.sql.Encoders\n\n","user":"anonymous","dateUpdated":"2020-12-30T11:28:13+0100","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import com.devonfw.application.mtsj.clustermanagement.dataaccess.api.GeobookingEntity\nimport org.insightedge.spark.implicits.all._\nimport org.insightedge.spark.context.InsightEdgeConfig\nimport org.apache.spark.ml.feature.VectorAssembler\nimport org.apache.spark.ml.clustering.KMeans\nimport spark.implicits._\nimport org.apache.spark.sql.Encoders\n"}]},"apps":[],"jobName":"paragraph_1607354785074_2012954557","id":"20201207-162625_1263182482","dateCreated":"2020-12-07T16:26:25+0100","dateStarted":"2021-01-01T23:37:07+0100","dateFinished":"2021-01-01T23:37:12+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:529"},{"title":"Get Data from the Space","text":"%spark\n\nval ieConfig = new InsightEdgeConfig(\"CG-space\")\nsc.initializeInsightEdgeContext(ieConfig)\nval sqlRdd = sc.gridSql[GeobookingEntity](\"dishId = ? AND bookingDate > ? AND bookingDate < ?\",Seq(String.format(\"%.0f\",dishId),startDate.asInstanceOf[Number].longValue,endDate.asInstanceOf[Number].longValue))\n\n","user":"anonymous","dateUpdated":"2021-01-01T15:32:02+0100","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true,"lineNumbers":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"ieConfig: org.insightedge.spark.context.InsightEdgeConfig = InsightEdgeConfig(CG-space,None,None)\nres1: org.apache.spark.SparkContext = org.apache.spark.SparkContext@6e16c97f\nsqlRdd: org.insightedge.spark.rdd.InsightEdgeSqlRDD[com.devonfw.application.mtsj.clustermanagement.dataaccess.api.GeobookingEntity] = InsightEdgeSqlRDD[77] at RDD at InsightEdgeAbstractRDD.scala:37\n"}]},"apps":[],"jobName":"paragraph_1607354880902_1419606500","id":"20201207-162800_2029889882","dateCreated":"2020-12-07T16:28:00+0100","dateStarted":"2021-01-01T23:37:12+0100","dateFinished":"2021-01-01T23:37:14+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:530"},{"title":"Add feature vector","text":"%spark\nimplicit val geoBookingEncoder = Encoders.bean(classOf[GeobookingEntity])\nval geobookings = sqlRdd.toDF()\nval cols = Array(\"latitude\", \"longitude\")\nval assembler = new VectorAssembler().setInputCols(cols).setOutputCol(\"features\")\nval featureDf = assembler.transform(geobookings)","user":"anonymous","dateUpdated":"2021-01-01T15:32:05+0100","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true,"lineNumbers":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"geoBookingEncoder: org.apache.spark.sql.Encoder[com.devonfw.application.mtsj.clustermanagement.dataaccess.api.GeobookingEntity] = class[amount[0]: int, bookingDate[0]: bigint, dishId[0]: string, dishName[0]: string, id[0]: string, latitude[0]: double, longitude[0]: double, modificationCounter[0]: int, prediction[0]: int]\ngeobookings: org.apache.spark.sql.DataFrame = [amount: int, bookingDate: bigint ... 7 more fields]\ncols: Array[String] = Array(latitude, longitude)\nassembler: org.apache.spark.ml.feature.VectorAssembler = vecAssembler_f1d9d8ba7cb0\nfeatureDf: org.apache.spark.sql.DataFrame = [amount: int, bookingDate: bigint ... 8 more fields]\n"}]},"apps":[],"jobName":"paragraph_1607354789277_-2035792937","id":"20201207-162629_882618425","dateCreated":"2020-12-07T16:26:29+0100","dateStarted":"2021-01-01T23:37:14+0100","dateFinished":"2021-01-01T23:37:17+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:531"},{"title":"Apply K-Means model and store the Data into the Grid","text":"%spark\nval kmeans = new KMeans()\n  .setK(8)\n  .setFeaturesCol(\"features\")\n  .setPredictionCol(\"modelPrediction\")\n\nval kmeansModel = kmeans.fit(featureDf)\nval result = kmeansModel.transform(featureDf)\n\nval geobookingDF = result.as(geoBookingEncoder).select(\"amount\",\"bookingDate\",\"dishId\",\"dishName\",\"latitude\",\"longitude\",\"id\",\"modelPrediction\",\"modificationCounter\").withColumnRenamed(\"modelPrediction\",\"prediction\")\nval geobookingDS = geobookingDF.as[GeobookingEntity](geoBookingEncoder)\n\nval geobookingPrediction = geobookingDS.rdd.saveToGrid()\n","user":"anonymous","dateUpdated":"2021-01-01T16:41:06+0100","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true,"lineNumbers":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"kmeans: org.apache.spark.ml.clustering.KMeans = kmeans_3f893f89b71f\nkmeansModel: org.apache.spark.ml.clustering.KMeansModel = kmeans_3f893f89b71f\nresult: org.apache.spark.sql.DataFrame = [amount: int, bookingDate: bigint ... 9 more fields]\ngeobookingDF: org.apache.spark.sql.DataFrame = [amount: int, bookingDate: bigint ... 7 more fields]\ngeobookingDS: org.apache.spark.sql.Dataset[com.devonfw.application.mtsj.clustermanagement.dataaccess.api.GeobookingEntity] = [amount: int, bookingDate: bigint ... 7 more fields]\ngeobookingPrediction: Unit = ()\n"}]},"apps":[],"jobName":"paragraph_1607368988777_1442698430","id":"20201207-202308_1017074565","dateCreated":"2020-12-07T20:23:08+0100","dateStarted":"2021-01-01T23:37:17+0100","dateFinished":"2021-01-01T23:37:25+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:532"},{"text":"%spark\n","user":"anonymous","dateUpdated":"2020-12-30T12:23:18+0100","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1609327398996_588805042","id":"20201230-122318_739847068","dateCreated":"2020-12-30T12:23:18+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:533"}],"name":"Geobooking","id":"2FTCU8CG3","noteParams":{},"noteForms":{},"angularObjects":{"python:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}